var AVG_PROJECT_CODE="a13",AVG_NA_PROJECT_CODE="a13na",APP_INFO=null;window.adapterApi={},adapterApi.LOCATION={cn:"cn",tw:"tw",gb:"gb",ja:"ja",ko:"ko",vi:"vi",th:"th"};var nt="49,54,51,46,99,111,109",decryptoByCC=function(e){if("string"!=typeof e)return e;for(var a=e.split(","),t=[],i=0;i<a.length;i++)t.push(String.fromCharCode(a[i]));return t.join("")},A13NA_CHANNEL={};A13NA_CHANNEL[adapterApi.LOCATION.gb]={android:["a13naxx2gb@google_play","a13naxx1gb@google_play"],ios:"a13naxx2gb@app_store",web:"a13naxx2gb@web"},A13NA_CHANNEL[adapterApi.LOCATION.tw]={android:"a13naxx2hmt@google_play",ios:"a13naxx2hmt@app_store",web:"a13naxx2hmt@web"},A13NA_CHANNEL[adapterApi.LOCATION.ja]={android:"a13naxx2jp@google_play",ios:"a13naxx2jp@app_store",web:"a13naxx2jp@web"},A13NA_CHANNEL[adapterApi.LOCATION.ko]={android:"a13naxx2kr@google_play",ios:"a13naxx2kr@app_store",web:"a13naxx2kr@web"},A13NA_CHANNEL[adapterApi.LOCATION.th]={android:"a13naxx2th@google_play",ios:"a13naxx2th@app_store",web:"a13naxx2th@web"},A13NA_CHANNEL[adapterApi.LOCATION.vi]={android:"a13naxx2gb@google_play",ios:"a13naxx2gb@app_store",web:"a13naxx2gb@web"},adapterApi.ENV_LOCAL=-1,adapterApi.ENV_DEV=1,adapterApi.ENV_TEST=0,adapterApi.ENV_RELEASE=2,adapterApi.ENV_GRAY=3,adapterApi.ENV_PRO=4,adapterApi.LOCAL_HOST="127.0.0.1:8360",adapterApi.DEV_HOST="dev.avg."+decryptoByCC(nt),adapterApi.TEST_HOST="testing.avg."+decryptoByCC(nt),adapterApi.RELEASE_HOST="release.avg."+decryptoByCC(nt),adapterApi.GRAY_HOST="gray.avg."+decryptoByCC(nt),adapterApi.PRO_HOST="avg."+decryptoByCC(nt),adapterApi.getLocation=function(e){for(var a in A13NA_CHANNEL)for(var t in A13NA_CHANNEL[a])if(Array.isArray(A13NA_CHANNEL[a][t])){for(var i in A13NA_CHANNEL[a][t])if(e===A13NA_CHANNEL[a][t][i])return adapterApi.LOCATION[a]}else if(e===A13NA_CHANNEL[a][t])return adapterApi.LOCATION[a];return adapterApi.LOCATION.cn},adapterApi.getHost=function(e){switch(e){case adapterApi.LOCATION.tw:adapterApi.DEV_HOST="dev.dokific.com",adapterApi.TEST_HOST="testing.dokific.com",adapterApi.RELEASE_HOST="release.tw.dokific.com",adapterApi.GRAY_HOST="gray.tw.dokific.com",adapterApi.PRO_HOST="tw.dokific.com";break;case adapterApi.LOCATION.gb:adapterApi.DEV_HOST="dev.dokific.com",adapterApi.TEST_HOST="testing.dokific.com",adapterApi.RELEASE_HOST="release.gb.dokific.com",adapterApi.GRAY_HOST="gray.gb.dokific.com",adapterApi.PRO_HOST="gb.dokific.com";break;case adapterApi.LOCATION.ja:adapterApi.DEV_HOST="dev.dokific.com",adapterApi.TEST_HOST="testing.dokific.com",adapterApi.RELEASE_HOST="release.jp.dokific.com",adapterApi.GRAY_HOST="gray.jp.dokific.com",adapterApi.PRO_HOST="jp.dokific.com";break;case adapterApi.LOCATION.ko:adapterApi.DEV_HOST="dev.dokific.com",adapterApi.TEST_HOST="testing.dokific.com",adapterApi.RELEASE_HOST="release.kr.dokific.com",adapterApi.GRAY_HOST="gray.kr.dokific.com",adapterApi.PRO_HOST="kr.dokific.com";break;case adapterApi.LOCATION.th:adapterApi.DEV_HOST="dev.dokific.com",adapterApi.TEST_HOST="testing.dokific.com",adapterApi.RELEASE_HOST="release.th.dokific.com",adapterApi.GRAY_HOST="gray.th.dokific.com",adapterApi.PRO_HOST="th.dokific.com";break;case adapterApi.LOCATION.vi:adapterApi.DEV_HOST="dev.dokific.com",adapterApi.TEST_HOST="testing.dokific.com",adapterApi.RELEASE_HOST="release.gb.dokific.com",adapterApi.GRAY_HOST="gray.gb.dokific.com",adapterApi.PRO_HOST="gb.dokific.com";break;default:adapterApi.DEV_HOST="dev.avg."+decryptoByCC(nt),adapterApi.TEST_HOST="testing.avg."+decryptoByCC(nt),adapterApi.RELEASE_HOST="release.avg."+decryptoByCC(nt),adapterApi.GRAY_HOST="gray.avg."+decryptoByCC(nt),adapterApi.PRO_HOST="avg."+decryptoByCC(nt)}};var channelConfig={default:{coinNamePath:"mall/unit/cyb",rate:1},lofter:{coinNamePath:"mall/unit/lfb",rate:1},KKMH:{coinNamePath:"mall/unit/kkb",rate:10}};adapterApi.getChannelConfig=function(){var e=Object.keys(channelConfig);return cc.sys.isNative&&APP_INFO&&e.indexOf(APP_INFO.appChannel)>-1?channelConfig[APP_INFO.appChannel]:!cc.sys.isNative&&e.indexOf(AVG_CHANNEL)>-1?channelConfig[AVG_CHANNEL]:channelConfig.default},window.locationUtils={refresh:function(){}},cc.sys.isNative&&(window.location={},locationUtils.refresh=function(){switch(location.search="",avg.jsb.getServerType()){case adapterApi.ENV_DEV:location.host=adapterApi.DEV_HOST,location.protocol="http:";break;case adapterApi.ENV_TEST:location.host=adapterApi.TEST_HOST,location.protocol="http:";break;case adapterApi.ENV_RELEASE:location.host=adapterApi.RELEASE_HOST,location.protocol="http:";break;case adapterApi.ENV_GRAY:location.host=adapterApi.GRAY_HOST,location.protocol="https:";break;case adapterApi.ENV_PRO:location.host=adapterApi.PRO_HOST,location.protocol="https:"}location.appendSearch=function(e,a){if(void 0!==e){var t=!location.search?"?":"&";void 0!==a&&""!==a||(location.search+=t+e),location.search+=t+e+"="+a}};var e=avg.jsb.getGameId();null===e?location.appendSearch("gameId",968):location.appendSearch("gameId",e);var a=avg.jsb.getAppChannel();null===a?a="":location.appendSearch("channel",a),cc.sys.isNative&&cc.sys.os!==cc.sys.OS_WINDOWS&&location.appendSearch("useNativeLocalStorage","true"),location.href=location.protocol+"//"+location.host+location.search},locationUtils.refresh());var AVG_PREURL,AVG_GAMEID,AVG_INVITE_CODE,SERVER_HOST=window.location.protocol+"//"+window.location.host,CHECK_GAME_AVAILABLE=!0,isDoViolateDetect=!1;!function(){AVGHttpPreUrl={EditorGame:"/avg-editor-api/game/",PortalGame:"/avg-portal-api/game/",TestGame:"/avg-portal-api/test/",ManageGame:"/avg-manage-api/preview/"};var e=new RegExp("(^|&)debug","i"),a=new RegExp("(^|&)test","i"),t=new RegExp("(^|&)manage","i");function i(e){var a=new RegExp("(^|&)"+e+"([=]*[^&]*)(&|$)","i"),t=window.location.search.substr(1).match(a);return null!=t&&t[2].length>0?unescape(t[2].substr(1)):null}AVG_PREURL=e.test(window.location.search.substr(1))?AVGHttpPreUrl.EditorGame:a.test(window.location.search.substr(1))?AVGHttpPreUrl.TestGame:t.test(window.location.search.substr(1))?AVGHttpPreUrl.ManageGame:AVGHttpPreUrl.PortalGame,AVG_GAMEID=i("gameId"),AVG_INVITE_CODE=i("invitationCode")}();var initProjectCode=function(){if(APP_INFO&&APP_INFO.appChannel)for(var e in A13NA_CHANNEL)for(var a in A13NA_CHANNEL[e])if(Array.isArray(A13NA_CHANNEL[e][a])){for(var t in A13NA_CHANNEL[e][a])if(APP_INFO.appChannel===A13NA_CHANNEL[e][a][t]){AVG_PROJECT_CODE=AVG_NA_PROJECT_CODE;break}}else if(APP_INFO.appChannel===A13NA_CHANNEL[e][a]){AVG_PROJECT_CODE=AVG_NA_PROJECT_CODE;break}},getToken=function(){if(cc.sys.isNative)return avg.jsb.getToken();for(var e,a=document.cookie.split(";"),t=0;t<a.length;t++)if((e=a[t].split("="))[0]&&"token"===e[0].trim().toLowerCase())return e[1];return null},getModeUrl=function(){var e=getToken(),a="";return a=e?SERVER_HOST+AVG_PREURL+AVG_GAMEID+"/edit/mode?csrf_token="+e+"&timestamp="+(new Date).getTime():SERVER_HOST+AVG_PREURL+AVG_GAMEID+"/edit/mode?timestamp="+(new Date).getTime(),AVG_INVITE_CODE&&(a+="&code="+AVG_INVITE_CODE),a},getJsModeConfigByXhr=function(e){var a=cc.loader.getXMLHttpRequest(),t=getModeUrl();a.open("GET",t,!0),CHECK_GAME_AVAILABLE=!0,a.onreadystatechange=function(){if(4===a.readyState&&a.status>=200&&a.status<=207){var t=a.responseText,i=JSON.parse(t);505001===i.state.code?(CHECK_GAME_AVAILABLE=!1,e&&e(i.data)):2e5===i.state.code?(i.data.replaceFlag&&(isDoViolateDetect=!0),e&&e(i.data)):e&&e(null)}},a.onerror=function(){},a.ontimeout=function(){},a.send()},getJsModeConfigH5=function(e){getJsModeConfigByXhr(e)},getJsModeConfigNative=function(e){var a={};a.url=getModeUrl(),a.method="GET",a.timeout=6e4,a.paramtype=0,a.requestType=0,avg.jsb.callAppApi("avgHttpHandler",JSON.stringify(a),(function(a){var t=JSON.parse(a),i=Number(t.state.code);if(CHECK_GAME_AVAILABLE=!0,i>=200&&i<300){var o=JSON.parse(t.response);505001===o.state.code?(CHECK_GAME_AVAILABLE=!1,e&&e(o.data)):2e5===o.state.code?(o.data.replaceFlag&&(isDoViolateDetect=!0),e&&e(o.data)):e&&e(null)}}))},getJsModeConfigWindowsAndMac=function(e){e&&e(null)},getJsModeConfig=function(e){var a=function(a){AVG_CREATIVE_TYPE=1,AVG_ALLOW_PAY=!1,AVG_SHOW_WELFARE_CENTER=!1,a&&void 0!==a.creativeType&&(AVG_CREATIVE_TYPE=a.creativeType),a&&void 0!==a.allowPay?AVG_ALLOW_PAY=!!a.allowPay:AVG_ALLOW_PAY=3!==AVG_CREATIVE_TYPE,AVG_GAME_VERSION_ID=a&&a.gameVersionId,a&&void 0!==a.showWelfareCenter&&(AVG_SHOW_WELFARE_CENTER=a.showWelfareCenter);var t=1;a&&void 0!==a.mode&&(t=a.mode),e(t)};cc.sys.isNative?cc.sys.os===cc.sys.OS_IOS||cc.sys.os===cc.sys.OS_ANDROID?getJsModeConfigNative(a):cc.sys.os!==cc.sys.OS_WINDOWS&&cc.sys.os!==cc.sys.OS_OSX||getJsModeConfigWindowsAndMac(a):getJsModeConfigH5(a)},startAvgMode=function(){cc.log("[main] startAvgMode"),adapterApi.delayInitApi(),AVG_ENGINE.actuator.begin(),EngineJSBridge.getAppInfo((function(e){if((APP_INFO=e)&&!BaseUtils.isNil(APP_INFO.indieGameId)&&APP_INFO.indieGameId>0&&(AVG_IS_INDIE_GAME=!0),cc.sys.isNative||initProjectCode(),versionUtil.versionControlAllowLeftExit()||EngineJSBridge.setLeftSlideExitGame(0),AVGInternational.init(),httpService.initService(),versionUtil.fixFontPathErrorIOS(),LocalStorageUtils.initLocalStorage(),cc.ENABLE_STACKABLE_ACTIONS=0,cc.game.onStart=function(){cc.warn("已启动游戏，无法多次启动游戏")},BrowserUtils.isMobileBrowser()&&PreloadStrategy.initMobile(),(BrowserUtils.isAndroidAPPWebView()||BrowserUtils.isIOSAPPWebView())&&EngineJSBridge.avgMemoryInfo((function(e){e&&PreloadStrategy.adjustByMemory(e.totalMemory)})),!cc.sys.isNative&&document.getElementById("cocosLoading")&&document.body.removeChild(document.getElementById("cocosLoading")),cc.view.enableRetina(cc.sys.os===cc.sys.OS_IOS||cc.sys.os===cc.sys.OS_ANDROID),cc.view.adjustViewPort(!0),cc.sys.isNative||setTimeout((function(){var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}),300),EngineJSBridge.registerAppApiJsCallbacks(),!cc.sys.isNative){var a=Number(httpUtils.getQueryString("sW")),t=Number(httpUtils.getQueryString("sH"));a&&BaseUtils.isNumber(a)&&t&&BaseUtils.isNumber(t)&&(cc.game.canvas.width=a,cc.game.canvas.height=t)}LoggerUtils.initGameShowLog(),AVGKeyHandler.initKeyListener(),AVGGame.runGame()}))},prepareAvgMode=function(){cc.log("[main] prepareAvgMode"),AVG_ERROR_HANDLER=new AVGErrorHandler,EngineJSBridge.avgGamePlayLog(AVGGameStatusLog.CodeLoaded),EngineJSBridge.avgGamePlayIsStarted((function(e){e&&cc.game.run()}))},startGame=function(e){var a;switch(e){case 1:case 2:window.ENABLE_IMAEG_POOL=!1,AVG_ENGINE={},cc.game.onStart=startAvgMode,cc.game.prepare(prepareAvgMode);break;case 3:case 4:cc.sys.isNative?(jsb.fileUtils.addSearchPath("jsmode",!0),cc.game.prepare((function(){cc.game.onStart=window.initGame,cc.game.run()}))):(a=location.href.replace("/engine/","/enginejs/"),location.replace(a));break;case 5:cc.sys.isNative?(jsb.fileUtils.addSearchPath("2dmode",!0),cc.game.prepare((function(){cc.game.onStart=window.initEngine,cc.game.run()}))):(a=location.href.replace("/engine/","/engine2d/"),location.replace(a));break;default:console.warn("不存在的mode：",e)}},start=function(){if(cc.sys.isNative){var e=JSON.parse(avg.jsb.getGameInfo());e&&e.appChannel&&(adapterApi.getHost(adapterApi.getLocation(e.appChannel)),locationUtils.refresh(),SERVER_HOST=window.location.protocol+"//"+window.location.host,"function"==typeof avg.jsb.setHost&&avg.jsb.setHost(SERVER_HOST)),APP_INFO=e,initProjectCode()}else APP_INFO=null;getJsModeConfig(startGame)};start();